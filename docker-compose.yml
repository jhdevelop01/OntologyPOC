version: "3.8"

services:
  neo4j:
    image: neo4j:5.26.0-community
    container_name: neo4j-upw
    ports:
      - "17474:7474"   # HTTP (Browser) - using 17474 to avoid conflict
      - "17687:7687"   # Bolt - using 17687 to avoid conflict
    environment:
      # Authentication
      NEO4J_AUTH: neo4j/password123

      # Plugins - n10s (required) + apoc (optional, for advanced queries)
      NEO4J_PLUGINS: '["n10s","apoc"]'

      # Security - Allow n10s/apoc procedures
      NEO4J_dbms_security_procedures_unrestricted: "n10s.*,apoc.*"
      NEO4J_dbms_security_procedures_allowlist: "n10s.*,apoc.*,gds.*"

      # File import - Allow file:// URLs
      NEO4J_dbms_security_allow__csv__import__from__file__urls: "true"

      # Memory settings (adjust based on your system)
      NEO4J_server_memory_heap_initial__size: "512m"
      NEO4J_server_memory_heap_max__size: "1G"
      NEO4J_server_memory_pagecache_size: "512m"

      # Accept license
      NEO4J_ACCEPT_LICENSE_AGREEMENT: "yes"
    volumes:
      # Mount ontology files to /import directory
      - ./ontology:/import
      # Persist data
      - neo4j_data:/data
      - neo4j_logs:/logs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7474"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 40s
    restart: unless-stopped

volumes:
  neo4j_data:
  neo4j_logs:
